-- Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0

module Daml.Finance.Account.Test.Util where

import DA.Set qualified as S (empty, fromList, singleton)
import Daml.Finance.Interface.Account.Account qualified as Account (Controllers(..))

-- | Options for transfer controllers.
data ControlledBy
  = Owners
    -- ^ Owner controls inbound and outbound transfers.
  | Custodian
    -- ^ Custodian controls inbound and outbound transfers
  | OwnersAndCustodian
    -- ^ Owners-and-custodian controller.
  | OwnerOnly
    -- ^ Owner controls outbound transfers, inbound transfers are auto-approved.
  deriving (Eq, Show)

-- | Set controllers depending on controlledBy.
setControllers : Party -> Party -> ControlledBy -> Account.Controllers
setControllers custodian owner controlledBy =
  case controlledBy of
    Owners -> Account.Controllers with instructors = S.singleton owner; approvers = S.singleton owner
    Custodian -> Account.Controllers with instructors = S.singleton custodian; approvers = S.singleton custodian
    OwnersAndCustodian -> Account.Controllers with instructors = S.fromList [owner, custodian]; approvers = S.fromList [owner, custodian]
    OwnerOnly -> Account.Controllers with instructors = S.singleton owner; approvers = S.empty
