-- Copyright (c) 2023 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0

module Daml.Finance.Instrument.Equity.Test.Util where

import DA.Map qualified as M
import Daml.Finance.Instrument.Equity.Instrument qualified as Equity (Instrument(..))
import Daml.Finance.Interface.Instrument.Base.Instrument qualified as BaseInstrument (I)
import Daml.Finance.Interface.Types.Common.Types (Id(..), InstrumentKey, Parties)
import Daml.Finance.Interface.Util.SyntheticKey (getKey)
import Daml.Script

originateEquity : Party -> Party -> Text -> Text -> Text -> [(Text, Parties)] -> Time ->
  Script InstrumentKey
originateEquity depository issuer label version description observers timestamp = do
  let
    instrument = Equity.Instrument with
      depository; issuer; id = Id label; version; description
      observers = M.fromList observers; validAsOf = timestamp
  submitMulti [depository, issuer] [] do createCmd instrument
  pure $ getKey $ toInterface @BaseInstrument.I instrument
