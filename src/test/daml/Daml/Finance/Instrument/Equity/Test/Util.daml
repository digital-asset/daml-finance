-- Copyright (c) 2022 Digital Asset (Switzerland) GmbH and/or its affiliates. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0

module Daml.Finance.Instrument.Equity.Test.Util where

import DA.Map qualified as M
import DA.Set (Set)
import Daml.Finance.Asset.Test.Util.Instrument (createReference)
import Daml.Finance.Instrument.Equity.Instrument (Instrument(..))
import Daml.Finance.Interface.Common.Types (VersionedId(..), Parties)
import Daml.Finance.Interface.Instrument.Base.Instrument qualified as Instrument (K)
import Daml.Script

originateEquity : Party -> Party -> Text -> Text -> [(Text, Set Parties)] -> Time -> Script Instrument.K
originateEquity depository issuer label version observers timestamp = do
  cid <- coerceContractId <$> submitMulti [depository, issuer] [] do
    createCmd Instrument with depository; issuer; id = (VersionedId with label; description = "Equity"; version); observers = M.fromList observers; validAsOf = timestamp
  createReference cid depository issuer observers
